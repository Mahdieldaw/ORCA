(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[720],{9045:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>e3});var s=a(5155),r=a(2115);let n=(0,a(5453).v)(e=>({activeWorkflowId:null,activeStageOrder:null,currentExecutionId:null,isGhostOverlayOpen:!1,isSnapshotDrawerOpen:!1,setActiveWorkflowId:t=>e(e=>e.activeWorkflowId!==t?{activeWorkflowId:t,activeStageOrder:null,currentExecutionId:null}:{activeWorkflowId:t}),setActiveStageOrder:t=>e({activeStageOrder:t}),setCurrentExecutionId:t=>e({currentExecutionId:t}),setGhostOverlayOpen:t=>e({isGhostOverlayOpen:t}),setSnapshotDrawerOpen:t=>e({isSnapshotDrawerOpen:t})}));var i=a(9373),l=a(6715),o=a(5041),d=a(7016),c=a(3464),u=a(9509);let m=c.A.create({baseURL:u.env.NEXT_PUBLIC_API_URL,headers:{"Content-Type":"application/json"}}),x=async e=>{let t={};return e&&(t.headers={Authorization:"Bearer ".concat(e)}),(await m.get("/workflows",t)).data},p=async(e,t)=>{let a={};return t&&(a.headers={Authorization:"Bearer ".concat(t)}),(await m.get("/executions/".concat(e),a)).data},f=async(e,t)=>{let a={};return t&&(a.headers={Authorization:"Bearer ".concat(t)}),(await m.get("/workflows/".concat(e),a)).data},h=async(e,t,a)=>{let s={};return a&&(s.headers={Authorization:"Bearer ".concat(a)}),(await m.post("/executions",{workflowId:e,inputs:t},s)).data},g=async(e,t)=>{let a={params:e?{workflowId:e}:{}};return t&&(a.headers={Authorization:"Bearer ".concat(t)}),(await m.get("/executions",a)).data},v=async(e,t)=>{let a={};return t&&(a.headers={Authorization:"Bearer ".concat(t)}),(await m.get("/executions/".concat(e,"/logs"),a)).data},w=async(e,t,a,s)=>{let r={};return s&&(r.headers={Authorization:"Bearer ".concat(s)}),(await m.put("/workflows/".concat(e,"/stages/").concat(t),a,r)).data},y=async(e,t,a,s)=>{let r={};return s&&(r.headers={Authorization:"Bearer ".concat(s)}),(await m.post("/executions/".concat(e,"/stages/").concat(t,"/validate"),{result:a},r)).data},b=async(e,t,a)=>{let s={};return a&&(s.headers={Authorization:"Bearer ".concat(a)}),(await m.post("/executions/".concat(e,"/stages/").concat(t,"/retry"),{},s)).data},j=async(e,t)=>{let a={};return t&&(a.headers={Authorization:"Bearer ".concat(t)}),(await m.post("/snapshots/".concat(e,"/restore"),{},a)).data},N=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a={params:e};return t&&(a.headers={Authorization:"Bearer ".concat(t)}),(await m.get("/snapshots",a)).data},k=async(e,t)=>{let a={};return t&&(a.headers={Authorization:"Bearer ".concat(t)}),(await m.post("/snapshots",{sourceWorkflowId:e.workflowId,name:e.name,description:e.description},a)).data},S=async(e,t)=>{let a={};t&&(a.headers={Authorization:"Bearer ".concat(t)}),await m.delete("/snapshots/".concat(e),a)},E={all:["workflows"],lists:()=>[...E.all,"list"],list:e=>[...E.lists(),{filters:e}],details:()=>[...E.all,"detail"],detail:e=>[...E.details(),e]},I={all:["executions"],lists:()=>[...I.all,"list"],list:e=>[...I.lists(),{filters:e}],details:()=>[...I.all,"detail"],detail:e=>[...I.details(),e],logs:e=>[...I.detail(e),"logs"]},z={all:["executions"],lists:()=>[...z.all,"list"],list:e=>[...z.lists(),e],details:()=>[...z.all,"detail"],detail:e=>[...z.details(),e],logs:()=>[...z.all,"logs"],log:e=>[...z.logs(),e]},C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{getToken:t}=(0,d.d)();return(0,i.I)({queryKey:z.list(e),queryFn:async()=>{let a=await t();return g(e.workflowId,a)},staleTime:6e4})},O=e=>{let{getToken:t}=(0,d.d)();return(0,i.I)({queryKey:z.detail(e),queryFn:async()=>p(e,await t()),enabled:!!e,staleTime:5e3})},A=(e,t)=>{var a;let{getToken:s}=(0,d.d)(),{data:r}=O(e),n=(null==r?void 0:r.status)==="RUNNING"||(null==r?void 0:r.status)==="PENDING";return(0,i.I)({queryKey:z.log(e),queryFn:async()=>v(e,await s()),enabled:(null!=(a=null==t?void 0:t.enabled)?a:!!e)&&!!r,staleTime:1e4,refetchInterval:e=>!!n&&5e3,refetchIntervalInBackground:n,refetchOnWindowFocus:n})},T=()=>{let e=(0,l.jE)(),{getToken:t}=(0,d.d)();return(0,o.n)({mutationFn:async e=>{let a=await t();return y(e.executionId,e.stageId,e.validationResult,a)},onSuccess:(t,a)=>{console.log("Manual validation recorded for stage ".concat(a.stageId,": ").concat(a.validationResult),t),e.invalidateQueries({queryKey:z.log(a.executionId)}),e.invalidateQueries({queryKey:z.detail(a.executionId)})},onError:(e,t)=>{console.error("Error recording validation for stage ".concat(t.stageId,":"),e)}})},R=()=>{let e=(0,l.jE)(),{getToken:t}=(0,d.d)();return(0,o.n)({mutationFn:async e=>{let{executionId:a,stageId:s}=e;return b(a,s,await t())},onSuccess:(t,a)=>{console.log("Stage ".concat(a.stageId," retry initiated:"),t),e.invalidateQueries({queryKey:z.log(a.executionId)}),e.invalidateQueries({queryKey:z.detail(a.executionId)})},onError:(e,t)=>{console.error("Error retrying stage ".concat(t.stageId,":"),e)}})},D=()=>{let e=(0,l.jE)(),{getToken:t}=(0,d.d)();return(0,o.n)({mutationFn:async e=>{let{workflowId:a,inputs:s}=e;return h(a,s,await t())},onSuccess:t=>{console.log("Execution started successfully:",t),e.invalidateQueries({queryKey:z.lists()})},onError:e=>{console.error("Error starting execution:",e)}})};var F=a(2596),P=a(9688);function L(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,P.QP)((0,F.$)(t))}let q=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:L("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});q.displayName="Card";let _=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:L("flex flex-col space-y-1.5 p-6",a),...r})});_.displayName="CardHeader";let M=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:L("text-2xl font-semibold leading-none tracking-tight",a),...r})});M.displayName="CardTitle";let K=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:L("text-sm text-muted-foreground",a),...r})});K.displayName="CardDescription";let B=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:L("p-6 pt-0",a),...r})});B.displayName="CardContent";let W=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:L("flex items-center p-6 pt-0",a),...r})});function Q(e){let{className:t,...a}=e;return(0,s.jsx)("div",{className:L("animate-pulse rounded-md bg-muted",t),...a})}W.displayName="CardFooter";let G=e=>{let{stage:t,latestLog:a,onMouseEnter:i,onMouseLeave:l}=e,o=n(e=>e.setActiveStageOrder),d=n(e=>e.activeStageOrder)===t.stageOrder,c=(0,r.useRef)(null),u=()=>{o(t.stageOrder)};return(0,s.jsxs)(q,{ref:c,className:L("relative flex flex-col w-[160px] sm:w-[180px] h-[120px] cursor-pointer transition-all duration-200 hover:shadow-md",d?"border-primary ring-1 ring-primary/50 bg-secondary/50":"border-border bg-card hover:border-muted-foreground/50 hover:scale-[1.02]"),onMouseEnter:()=>i(t.stageOrder,c.current),onMouseLeave:l,onClick:u,role:"button","aria-pressed":d,tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(u(),e.preventDefault())},children:[(0,s.jsx)(_,{className:"flex flex-row items-center justify-between p-3 pb-1",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"text-lg","aria-hidden":"true",children:"\uD83D\uDCC4"}),(0,s.jsx)(M,{className:"text-sm font-semibold truncate",children:t.name||"Stage ".concat(t.stageOrder)})]})}),(0,s.jsx)(B,{className:"p-3 pt-0 flex-grow",children:(0,s.jsx)("div",{className:"text-xs line-clamp-2 overflow-hidden",children:t.promptTemplate||"No description available"})}),(0,s.jsx)(W,{className:"p-3 pt-0 flex items-center space-x-1",children:t.validationType&&(0,s.jsx)("span",{className:"text-xs bg-muted px-2 py-0.5 rounded",children:t.validationType})})]})},U={all:["snapshots"],lists:()=>[...U.all,"list"],list:e=>[...U.lists(),e],details:()=>[...U.all,"detail"],detail:e=>[...U.details(),e]},V=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{getToken:t}=(0,d.d)();return(0,i.I)({queryKey:U.list(e),queryFn:async()=>N(e,await t()),staleTime:3e5})},J=()=>{let e=(0,l.jE)(),{getToken:t}=(0,d.d)();return(0,o.n)({mutationFn:async e=>k(e,await t()),onSuccess:t=>{e.invalidateQueries({queryKey:U.lists()}),e.setQueryData(U.detail(t.id),t),console.log("Snapshot created successfully:",t)},onError:e=>{console.error("Error creating snapshot:",e)}})},Y=()=>{let e=(0,l.jE)(),{getToken:t}=(0,d.d)();return(0,o.n)({mutationFn:async e=>j(e,await t()),onSuccess:(t,a)=>{console.log("Restored successfully from snapshot ".concat(a,":"),t),"stages"in t?e.invalidateQueries({queryKey:E.lists()}):e.invalidateQueries({queryKey:I.lists()})},onError:(e,t)=>{console.error("Error restoring from snapshot ".concat(t,":"),e)}})},H=()=>{let e=(0,l.jE)(),{getToken:t}=(0,d.d)();return(0,o.n)({mutationFn:async e=>S(e,await t()),onSuccess:(t,a)=>{console.log("Snapshot ".concat(a," deleted successfully")),e.invalidateQueries({queryKey:U.lists()}),e.removeQueries({queryKey:U.detail(a)})},onError:(e,t)=>{console.error("Error deleting snapshot ".concat(t,":"),e)}})};var Z=a(3974);let X=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:L("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...r})});X.displayName="Textarea";var $=a(968),ee=a(2085);let et=(0,ee.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ea=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)($.b,{ref:t,className:L(et(),a),...r})});ea.displayName=$.b.displayName;var es=a(9708);let er=(0,ee.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-white transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-zinc-950 dark:focus-visible:ring-zinc-300",{variants:{variant:{default:"bg-zinc-900 text-zinc-50 hover:bg-zinc-900/90 dark:bg-zinc-50 dark:text-zinc-900 dark:hover:bg-zinc-50/90",destructive:"bg-red-500 text-zinc-50 hover:bg-red-500/90 dark:bg-red-900 dark:text-zinc-50 dark:hover:bg-red-900/90",outline:"border border-zinc-200 bg-white hover:bg-zinc-100 hover:text-zinc-900 dark:border-zinc-800 dark:bg-zinc-950 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",secondary:"bg-zinc-100 text-zinc-900 hover:bg-zinc-100/80 dark:bg-zinc-800 dark:text-zinc-50 dark:hover:bg-zinc-800/80",ghost:"hover:bg-zinc-100 hover:text-zinc-900 dark:hover:bg-zinc-800 dark:hover:text-zinc-50",link:"text-zinc-900 underline-offset-4 hover:underline dark:text-zinc-50"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),en=r.forwardRef((e,t)=>{let{className:a,variant:r,size:n,asChild:i=!1,...l}=e,o=i?es.DX:"button";return(0,s.jsx)(o,{className:L(er({variant:r,size:n,className:a})),ref:t,...l})});en.displayName="Button";var ei=a(4439);let el=r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(ei.bL,{ref:t,className:L("relative overflow-hidden",a),...n,children:[(0,s.jsx)(ei.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,s.jsx)(eo,{}),(0,s.jsx)(ei.OK,{})]})});el.displayName=ei.bL.displayName;let eo=r.forwardRef((e,t)=>{let{className:a,orientation:r="vertical",...n}=e;return(0,s.jsx)(ei.VM,{ref:t,orientation:r,className:L("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...n,children:(0,s.jsx)(ei.lr,{className:"relative flex-1 rounded-full bg-border"})})});eo.displayName=ei.VM.displayName;var ed=a(3319);let ec=(0,ee.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),eu=r.forwardRef((e,t)=>{let{className:a,variant:r,...n}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:L(ec({variant:r}),a),...n})});eu.displayName="Alert";let em=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h5",{ref:t,className:L("mb-1 font-medium leading-none tracking-tight",a),...r})});em.displayName="AlertTitle";let ex=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:L("text-sm [&_p]:leading-relaxed",a),...r})});ex.displayName="AlertDescription";let ep=0,ef=new Map,eh=e=>{if(ef.has(e))return;let t=setTimeout(()=>{ef.delete(e),ey({type:"REMOVE_TOAST",toastId:e})},1e6);ef.set(e,t)},eg=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?eh(a):e.toasts.forEach(e=>{eh(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},ev=[],ew={toasts:[]};function ey(e){ew=eg(ew,e),ev.forEach(e=>{e(ew)})}function eb(e){let{...t}=e,a=(ep=(ep+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>ey({type:"DISMISS_TOAST",toastId:a});return ey({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>ey({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function ej(){let[e,t]=r.useState(ew);return r.useEffect(()=>(ev.push(t),()=>{let e=ev.indexOf(t);e>-1&&ev.splice(e,1)}),[e]),{...e,toast:eb,dismiss:e=>ey({type:"DISMISS_TOAST",toastId:e})}}var eN=a(1154),ek=a(333);let eS=e=>{let{workflowId:t,stage:a,activeTab:i,currentExecutionId:c,onTriggerSnapshotDrawer:u,latestLogForStage:m}=e,x=n(e=>e.activeWorkflowId),[p,f]=(0,r.useState)(a.promptTemplate||""),[h,g]=(0,r.useState)(!1),{data:v=[],isLoading:y}=V({workflowId:x||"",stageId:a.id}),{mutate:b}=Y(),{mutate:j}=J(),{mutate:N}=function(){let e=(0,l.jE)(),{getToken:t}=(0,d.d)();return(0,o.n)({mutationFn:async e=>{let{workflowId:a,stageId:s,data:r}=e;return w(a,s,r,await t())},onSuccess:(t,a)=>{e.invalidateQueries({queryKey:E.detail(a.workflowId)})},onError:(e,t)=>{console.error("Error updating stage ".concat(t.stageId," in workflow ").concat(t.workflowId,":"),e)}})}(),{toast:k}=ej(),{mutate:S,isPending:I}=T(),{mutate:z,isPending:C}=R();(0,r.useEffect)(()=>{f(a.promptTemplate||"")},[a.promptTemplate]);let O=(0,Z.YQ)(e=>{e!==a.promptTemplate&&(g(!0),N({workflowId:x||"",stageId:a.id,data:{promptTemplate:e}},{onSuccess:()=>g(!1),onError:()=>g(!1)}))},1e3),A=e=>{let t=e.target.value;f(t),O(t)},D=e=>{b(e,{onSuccess:()=>{},onError:()=>{}})},F=()=>{t&&j({workflowId:t,name:"Snapshot @ ".concat((0,ed.GP)(new Date,"Pp"))},{onSuccess:()=>{},onError:()=>{}})},P=e=>{c&&a.id&&S({executionId:c,stageId:a.id,validationResult:e?"pass":"fail",comments:e?"Manually passed":"Manually failed"},{onSuccess:()=>k({title:"Validation recorded",description:"Stage marked as ".concat(e?"Passed":"Failed",".")}),onError:()=>k({title:"Error",description:"Failed to record manual validation.",variant:"destructive"})})},L=()=>{c&&a.id&&z({executionId:c,stageId:a.id},{onSuccess:()=>k({title:"Retry started",description:"Stage retry initiated."}),onError:()=>k({title:"Error",description:"Failed to retry stage.",variant:"destructive"})})};return(()=>{switch(i){case"prompt":return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(ea,{htmlFor:"prompt",className:"text-sm font-medium text-foreground",children:"Edit Prompt"}),(0,s.jsx)("span",{className:"text-xs ".concat(h?"text-blue-500 animate-pulse":"text-muted-foreground"),children:h?"Saving...":"Changes saved automatically"})]}),(0,s.jsx)(X,{id:"prompt",value:p,onChange:A,className:"w-full min-h-[200px] sm:min-h-[300px] md:min-h-[400px] p-4 border rounded-md shadow-sm text-base focus-visible:ring-1 focus-visible:ring-ring",placeholder:"Enter your prompt template here..."})]});case"output":var e;return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(ea,{htmlFor:"output",className:"text-sm font-medium text-foreground",children:"Latest Output"}),(null==m?void 0:m.endedAt)&&(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Generated at: ",(0,ed.GP)(new Date(m.endedAt),"Pp")]})]}),(0,s.jsx)(q,{id:"output",className:"w-full min-h-[200px] sm:min-h-[300px] md:min-h-[400px]",children:(0,s.jsx)(B,{className:"p-4 whitespace-pre-wrap text-base overflow-y-auto",children:m?"failed"===m.status||"error"===m.status?m.errorDetails?(0,s.jsxs)(eu,{variant:"destructive",className:"mb-4",children:[(0,s.jsx)(em,{children:"Error"}),(0,s.jsx)(ex,{children:m.errorDetails})]}):(0,s.jsx)("span",{className:"text-destructive",children:"Stage failed, but no error details provided."}):"completed"===m.status||"passed"===m.status?(0,s.jsx)("pre",{className:"whitespace-pre-wrap break-words",children:m.processedOutput||m.rawOutput||"No output recorded for this status."}):"running"===m.status||"pending"===m.status?(0,s.jsx)("span",{className:"text-muted-foreground italic",children:"running"===m.status?"Running...":"Pending..."}):(0,s.jsx)("span",{className:"text-muted-foreground italic",children:"No output recorded for this status."}):(0,s.jsx)("span",{className:"text-muted-foreground italic",children:"No output available yet."})})}),"MANUAL"===a.validationType&&(null==m?void 0:m.status)==="awaiting_validation"&&(0,s.jsxs)("div",{className:"flex gap-4 mt-4",children:[(0,s.jsxs)(en,{variant:"outline",size:"sm",onClick:()=>P(!0),disabled:I,className:"flex-1 border-green-500 text-green-600 hover:bg-green-50 hover:text-green-700",children:[I?(0,s.jsx)(eN.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(ek.A,{className:"mr-2 h-4 w-4"})," Pass"]}),(0,s.jsx)(en,{variant:"destructive",onClick:()=>P(!1),disabled:I,children:"Fail"})]}),c&&((null==m?void 0:m.status)==="failed"||(null==m?void 0:m.status)==="error")&&"number"==typeof a.retryLimit&&(null!=(e=null==m?void 0:m.retryCount)?e:0)<a.retryLimit&&(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(en,{variant:"outline",onClick:L,disabled:C,children:"Retry Stage"})})]});case"snapshots":return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"Available Snapshots"}),(0,s.jsx)(en,{variant:"outline",size:"sm",onClick:F,disabled:!(null==m?void 0:m.executionId),children:"Take Snapshot"})]}),y?(0,s.jsx)("div",{children:"Loading snapshots..."}):0===v.length?(0,s.jsx)(q,{className:"text-center py-10 border-dashed",children:(0,s.jsxs)(B,{className:"flex flex-col items-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"No snapshots available for this stage yet."}),(0,s.jsx)(en,{size:"sm",onClick:F,disabled:!(null==m?void 0:m.executionId),children:"Create First Snapshot"})]})}):(0,s.jsx)(el,{className:"max-h-96 pr-3",children:(0,s.jsx)("div",{className:"space-y-3",children:v.map(e=>(0,s.jsxs)(q,{className:"transition-colors hover:border-primary/50",children:[(0,s.jsx)(_,{className:"p-3 pb-2",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(M,{className:"text-sm font-medium mb-1",children:e.name||"Snapshot from ".concat((0,ed.GP)(new Date(e.createdAt),"Pp"))}),(0,s.jsx)(K,{className:"text-xs",children:"Contains captured state data"})]}),(0,s.jsx)("div",{className:"flex space-x-2",children:(0,s.jsx)(en,{variant:"outline",size:"sm",onClick:()=>D(e.id),children:"Restore"})})]})}),(0,s.jsx)(B,{className:"p-3 pt-0",children:(0,s.jsx)("div",{className:"mt-2 pt-2 border-t",children:(0,s.jsxs)("p",{className:"text-xs text-muted-foreground line-clamp-2",children:["Created: ",(0,ed.GP)(new Date(e.createdAt),"P p")]})})})]},e.id))})})]});default:return null}})()},eE=e=>{let{stages:t,logs:a,workflowName:r,onShowPreview:i,onHidePreview:l,onTriggerSnapshotDrawer:o}=e,d=n(e=>e.activeStageOrder),c=n(e=>e.currentExecutionId),u=t.find(e=>e.stageOrder===d),m=u&&a.filter(e=>e.stageId===u.id&&e.executionId===c).sort((e,t)=>new Date(t.startedAt).getTime()-new Date(e.startedAt).getTime())[0]||null;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex space-x-4 overflow-x-auto pb-4",children:t.sort((e,t)=>e.stageOrder-t.stageOrder).map(e=>(0,s.jsx)(G,{stage:e,latestLog:null==a?void 0:a.findLast(t=>t.stageId===e.id&&t.executionId===c),onMouseEnter:i,onMouseLeave:l},e.id))}),u?(0,s.jsx)(eS,{workflowId:u.workflowId,stage:u,currentExecutionId:c,latestLogForStage:m,activeTab:"prompt",onTriggerSnapshotDrawer:o},u.id):(0,s.jsx)("div",{className:"text-center text-muted-foreground py-10",children:"Select a stage from the rail above to view details."})]})},eI=e=>{let{stage:t,position:a}=e,n=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(n.current){let e=n.current.getBoundingClientRect(),t=window.innerHeight,s=window.innerWidth,r=0,i=a.x;e.bottom>t-20&&(r=-(e.bottom-(t-20))),"right"===a.side&&e.right>s-20&&(i=s-e.width-20),n.current.style.transform="translateY(".concat(r,"px)"),n.current.style.left="".concat(Math.max(20,i),"px")}},[a,t.id]),(0,s.jsxs)(q,{ref:n,className:"fixed z-50 w-[350px] max-h-[300px] overflow-hidden shadow-xl transition-all duration-150 flex flex-col bg-card border",style:{left:"".concat(a.x,"px"),top:"".concat(a.y,"px")},children:[(0,s.jsxs)(_,{className:"flex flex-row items-center justify-between p-3 border-b",children:[(0,s.jsx)(M,{className:"text-base font-semibold truncate",children:t.name}),t.validationType&&(0,s.jsx)("span",{className:"text-xs bg-muted px-2 py-0.5 rounded ml-2",children:t.validationType})]}),(0,s.jsx)(B,{className:"p-3",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Prompt"}),(0,s.jsx)(q,{className:"bg-muted/50 max-h-[100px] overflow-hidden",children:(0,s.jsx)(B,{className:"p-2 text-xs",children:(0,s.jsx)("p",{className:"line-clamp-4 whitespace-pre-wrap",children:t.promptTemplate||(0,s.jsx)("span",{className:"italic text-muted-foreground/80",children:"No prompt available"})})})})]})})]})};var ez=a(2283),eC=a(4416);let eO=ez.bL;ez.l9;let eA=ez.ZL,eT=ez.bm,eR=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(ez.hJ,{ref:t,className:L("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});eR.displayName=ez.hJ.displayName;let eD=r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(eA,{children:[(0,s.jsx)(eR,{}),(0,s.jsxs)(ez.UC,{ref:t,className:L("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[r,(0,s.jsxs)(ez.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(eC.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});eD.displayName=ez.UC.displayName;let eF=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:L("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};eF.displayName="DialogHeader";let eP=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:L("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};eP.displayName="DialogFooter";let eL=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(ez.hE,{ref:t,className:L("text-lg font-semibold leading-none tracking-tight",a),...r})});eL.displayName=ez.hE.displayName;let eq=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(ez.VY,{ref:t,className:L("text-sm text-muted-foreground",a),...r})});eq.displayName=ez.VY.displayName;let e_=e=>{let{isOpen:t,onOpenChange:a,workflowId:n,workflowName:i,onSubmit:l,isStartingExecution:o}=e,{toast:d}=ej(),[c,u]=(0,r.useState)(""),[m,x]=(0,r.useState)(null);return(0,r.useEffect)(()=>{t&&(u(""),x(null))},[t]),(0,s.jsx)(eO,{open:t,onOpenChange:a,children:(0,s.jsxs)(eD,{children:[(0,s.jsxs)(eF,{children:[(0,s.jsxs)(eL,{children:["Start Execution for ",i]}),(0,s.jsx)(eq,{children:"Enter initial input data for this workflow. Use JSON format. Leave blank for no input."})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(ea,{htmlFor:"initial-inputs",children:"Initial Inputs (JSON)"}),m&&(0,s.jsxs)(eu,{variant:"destructive",children:[(0,s.jsx)(em,{children:"Error"}),(0,s.jsx)(ex,{children:m})]})]}),(0,s.jsxs)(eP,{children:[(0,s.jsx)(en,{onClick:()=>{try{let e=c.trim()?JSON.parse(c):{};x(null),l(e)}catch(e){x("Invalid JSON: "+(e.message||"Check your input.")),d({title:"Invalid JSON",description:e.message||"Check your input.",variant:"destructive"})}},disabled:o,className:"w-full",children:o?"Starting...":"Start Execution"}),(0,s.jsx)(eT,{asChild:!0,children:(0,s.jsx)(en,{variant:"outline",className:"w-full mt-2",disabled:o,children:"Cancel"})})]})]})})};function eM(e){let{open:t,onOpenChange:a,children:r}=e;return(0,s.jsxs)("div",{className:L("fixed inset-0 z-50 flex",t?"pointer-events-auto":"pointer-events-none hidden"),"aria-modal":"true",role:"dialog",style:{display:t?"flex":"none"},children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 transition-opacity",onClick:()=>a(!1)}),r]})}function eK(e){let{side:t="right",className:a,children:r,...n}=e;return(0,s.jsx)("div",{className:L("z-50 transition-transform duration-300",{right:"fixed top-0 right-0 h-full w-[420px] max-w-full bg-background shadow-lg border-l",left:"fixed top-0 left-0 h-full w-[420px] max-w-full bg-background shadow-lg border-r",top:"fixed top-0 left-0 w-full h-[420px] max-h-full bg-background shadow-lg border-b",bottom:"fixed bottom-0 left-0 w-full h-[420px] max-h-full bg-background shadow-lg border-t"}[t],a),...n,children:r})}function eB(e){let{children:t}=e;return(0,s.jsx)("div",{className:"px-6 pt-6 pb-2 border-b",children:t})}function eW(e){let{children:t}=e;return(0,s.jsx)("h2",{className:"text-lg font-semibold leading-none tracking-tight",children:t})}function eQ(e){let{children:t}=e;return(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:t})}let eG=r.forwardRef((e,t)=>{let{className:a,type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:L("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});eG.displayName="Input";var eU=a(7649);let eV=eU.bL;eU.l9;let eJ=eU.ZL,eY=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eU.hJ,{className:L("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});eY.displayName=eU.hJ.displayName;let eH=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsxs)(eJ,{children:[(0,s.jsx)(eY,{}),(0,s.jsx)(eU.UC,{ref:t,className:L("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-zinc-200 bg-white p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg dark:border-zinc-800 dark:bg-zinc-950",a),...r})]})});eH.displayName=eU.UC.displayName;let eZ=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:L("flex flex-col space-y-2 text-center sm:text-left",t),...a})};eZ.displayName="AlertDialogHeader";let eX=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:L("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};eX.displayName="AlertDialogFooter";let e$=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eU.hE,{ref:t,className:L("text-lg font-semibold",a),...r})});e$.displayName=eU.hE.displayName;let e0=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eU.VY,{ref:t,className:L("text-sm text-zinc-500 dark:text-zinc-400",a),...r})});e0.displayName=eU.VY.displayName;let e1=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eU.rc,{ref:t,className:L(er(),a),...r})});e1.displayName=eU.rc.displayName;let e2=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(eU.ZD,{ref:t,className:L(er({variant:"outline"}),"mt-2 sm:mt-0",a),...r})});e2.displayName=eU.ZD.displayName;let e5=e=>{let{isOpen:t,onOpenChange:a,snapshotToRestore:r,onConfirmRestore:n,isRestoring:i}=e;return r?(0,s.jsx)(eV,{open:t,onOpenChange:a,children:(0,s.jsxs)(eH,{children:[(0,s.jsxs)(eZ,{children:[(0,s.jsx)(e$,{children:"Restore Snapshot?"}),(0,s.jsxs)(e0,{children:['Are you sure you want to restore the workflow state from the snapshot named "',(0,s.jsx)("span",{className:"font-semibold",children:r.name}),'"? Any unsaved changes in the current editor might be lost.']})]}),(0,s.jsxs)(eX,{children:[(0,s.jsx)(e2,{disabled:i,children:"Cancel"})," ",(0,s.jsxs)(e1,{onClick:()=>{n(r.id)},disabled:i,children:[" ",i&&(0,s.jsx)(eN.A,{className:"mr-2 h-4 w-4 animate-spin"})," ",i?"Restoring...":"Restore Snapshot"]})]})]})}):null},e4=e=>{let{isOpen:t,onOpenChange:a,workflowId:n}=e,{toast:i}=ej(),[l,o]=(0,r.useState)(""),[d,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(null),[x,p]=(0,r.useState)(!1),[f,h]=(0,r.useState)(null),{data:g=[],isLoading:v,error:w,refetch:y}=V({workflowId:null!=n?n:void 0}),{mutate:b,isPending:j}=J(),{mutate:N,isPending:k}=Y(),{mutate:S,isPending:E}=H();return(0,r.useEffect)(()=>{t||(o(""),m(null),c(!1),h(null),p(!1))},[t]),(0,s.jsx)(eM,{open:t,onOpenChange:a,children:(0,s.jsxs)(eK,{side:"right",className:"w-[420px] max-w-full",children:[(0,s.jsxs)(eB,{children:[(0,s.jsx)(eW,{children:"Workflow Snapshots"}),(0,s.jsx)(eQ,{children:"Save, restore, or delete snapshots of your workflow for versioning and recovery."})]}),(0,s.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(eG,{placeholder:"Snapshot name",value:l,onChange:e=>o(e.target.value),disabled:j}),(0,s.jsx)(en,{onClick:()=>{n&&l.trim()&&b({workflowId:n,name:l.trim()},{onSuccess:()=>{i({title:"Snapshot saved",description:"Workflow snapshot created."}),o(""),y()},onError:()=>i({title:"Error",description:"Failed to save snapshot.",variant:"destructive"})})},disabled:j||!l.trim(),children:j?"Saving...":"Save Snapshot"})]}),v?(0,s.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsx)(Q,{className:"h-12 w-full rounded"},t))}):w?(0,s.jsxs)(eu,{variant:"destructive",children:[(0,s.jsx)(em,{children:"Error"}),(0,s.jsx)(ex,{children:"Failed to load snapshots."})]}):(0,s.jsx)(el,{className:"max-h-[400px] pr-2",children:(0,s.jsx)("div",{className:"space-y-2",children:0===g.length?(0,s.jsx)("div",{className:"text-muted-foreground text-sm text-center py-8",children:"No snapshots found for this workflow."}):g.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between border rounded p-3 bg-card",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.name||"Snapshot from ".concat((0,ed.GP)(new Date(e.createdAt),"Pp"))}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,ed.GP)(new Date(e.createdAt),"Pp")})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(en,{size:"sm",variant:"outline",onClick:()=>{let t=g.find(t=>t.id===e.id);t&&(m(t),c(!0))},children:"Restore"}),(0,s.jsx)(en,{size:"sm",variant:"destructive",onClick:()=>{h(e.id),p(!0)},children:"Delete"})]})]},e.id))})})]}),(0,s.jsx)(e5,{isOpen:d,onOpenChange:c,snapshotToRestore:u,isRestoring:k,onConfirmRestore:()=>{u&&N(u.id,{onSuccess:()=>{i({title:"Snapshot restored",description:"Workflow restored from snapshot."}),c(!1),m(null),a(!1)},onError:()=>i({title:"Error",description:"Failed to restore snapshot.",variant:"destructive"})})}}),(0,s.jsx)(eV,{open:x,onOpenChange:p,children:(0,s.jsxs)(eH,{children:[(0,s.jsxs)(eZ,{children:[(0,s.jsx)(e$,{children:"Delete Snapshot?"}),(0,s.jsx)(e0,{children:"This action cannot be undone. This will permanently delete the snapshot."})]}),(0,s.jsxs)(eX,{children:[(0,s.jsx)(e2,{children:"Cancel"}),(0,s.jsx)(e1,{onClick:()=>{f&&S(f,{onSuccess:()=>{i({title:"Snapshot deleted",description:"Snapshot removed."}),p(!1),h(null),y()},onError:()=>i({title:"Error",description:"Failed to delete snapshot.",variant:"destructive"})})},disabled:E,children:E?"Deleting...":"Delete"})]})]})})]})})};function e3(){let e=n(e=>e.activeWorkflowId),t=n(e=>e.setActiveWorkflowId),a=n(e=>e.currentExecutionId),l=n(e=>e.setCurrentExecutionId),o=n(e=>e.setActiveStageOrder),{data:c,isLoading:u,error:m}=function(){let{getToken:e}=(0,d.d)();return(0,i.I)({queryKey:E.lists(),queryFn:async()=>x(await e()),staleTime:3e5})}(),{data:p,isLoading:h,error:g}=function(e){let{getToken:t}=(0,d.d)();return(0,i.I)({queryKey:E.detail(e),queryFn:async()=>f(e,await t()),enabled:!!e,staleTime:6e5})}(e||void 0),{data:v=[],isLoading:w,error:y}=C(e?{workflowId:e}:void 0),{data:b=[],isLoading:j,error:N}=A(a),[k,S]=(0,r.useState)(null),[I,z]=(0,r.useState)({x:0,y:0,side:"right"}),[O,T]=(0,r.useState)(!1),[R,F]=(0,r.useState)(!1),{mutate:P,isPending:L}=D();return(0,r.useEffect)(()=>{m&&eb({title:"Error",description:"Failed to load workflows."}),g&&eb({title:"Error",description:"Failed to load workflow details."}),y&&eb({title:"Error",description:"Failed to load executions."}),N&&eb({title:"Error",description:"Failed to load execution logs."})},[m,g,y,N]),(0,s.jsxs)("div",{className:"flex min-h-screen bg-background",children:[(0,s.jsxs)("aside",{className:"w-[260px] border-r bg-card p-4 flex flex-col",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Workflows"}),u?(0,s.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsx)(Q,{className:"h-10 w-full rounded"},t))}):c&&c.length>0?(0,s.jsx)("div",{className:"space-y-2",children:c.map(a=>(0,s.jsxs)(q,{className:"cursor-pointer transition-colors ".concat(e===a.id?"border-primary bg-secondary/30":"hover:border-muted-foreground/40"),onClick:()=>t(a.id),tabIndex:0,"aria-pressed":e===a.id,children:[(0,s.jsx)(_,{className:"p-3 pb-1",children:(0,s.jsx)(M,{className:"text-base font-medium truncate",children:a.name})}),(0,s.jsx)(B,{className:"p-3 pt-0 text-xs text-muted-foreground line-clamp-2",children:a.description||"No description"})]},a.id))}):(0,s.jsx)("div",{className:"text-muted-foreground text-sm",children:"No workflows found."})]}),(0,s.jsxs)("main",{className:"flex-1 p-6 relative",children:[h?(0,s.jsx)(Q,{className:"h-10 w-1/2 mb-4"}):p?(0,s.jsx)(eE,{stages:p.stages,logs:null!=b?b:[],workflowName:p.name,onShowPreview:(e,t)=>{let a,s;if(!t)return;let r=t.getBoundingClientRect(),n=window.innerWidth;n-r.right>=416?(a=r.right+16,s="right"):r.left>=416?(a=r.left-400-16,s="left"):(a=Math.max(16,Math.min(n-400-16,r.left-200+r.width/2)),s="right"),z({x:a,y:r.top,side:s}),S(e)},onHidePreview:()=>{S(null)},onTriggerSnapshotDrawer:()=>T(!0)}):e?(0,s.jsx)("div",{className:"text-muted-foreground text-center mt-20",children:"Workflow not found or failed to load."}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Select a workflow to get started"}),(0,s.jsx)("p",{className:"text-center max-w-md",children:"Choose a workflow from the left panel to view its stages, run executions, and manage snapshots."})]}),p&&null!==k&&(()=>{let e=p.stages.find(e=>e.stageOrder===k);return e?(0,s.jsx)(eI,{stage:e,position:I}):null})(),(0,s.jsx)(e_,{isOpen:R,onOpenChange:F,workflowId:e||"",workflowName:(null==p?void 0:p.name)||"Workflow",onSubmit:t=>{e&&P({workflowId:e,inputs:t},{onSuccess:e=>{eb({title:"Execution Started",description:"Execution ".concat(e.id," initiated.")}),l(e.id),o(1),F(!1)},onError:e=>{eb({title:"Execution Failed",description:"Could not start: ".concat(e instanceof Error?e.message:String(e)),variant:"destructive"})}})},isStartingExecution:L}),(0,s.jsx)(e4,{isOpen:O,onOpenChange:T,workflowId:e})]})]})}},9495:(e,t,a)=>{Promise.resolve().then(a.bind(a,9045))}},e=>{var t=t=>e(e.s=t);e.O(0,[830,813,441,684,358],()=>t(9495)),_N_E=e.O()}]);