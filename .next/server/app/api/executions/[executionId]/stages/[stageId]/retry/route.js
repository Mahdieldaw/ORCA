(()=>{var e={};e.id=88,e.ids=[88],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3024:e=>{"use strict";e.exports=require("node:fs")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4478:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>c});var n=r(6559),o=r(8088),a=r(7719),i=r(2190),u=r(8945),d=r(6330);let p=new d.PrismaClient;async function c(e,{params:t}){let r=(await (0,u.j)()).userId;if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{executionId:s,stageId:n}=t;if(!s||!n)return i.NextResponse.json({error:"Missing executionId or stageId"},{status:400});try{if(!await p.execution.findUnique({where:{id:s},include:{workflow:{select:{id:!0,name:!0}}}}))return i.NextResponse.json({error:"Workflow execution not found"},{status:404});let e=await p.stage.findUnique({where:{id:n}});if(!e)return i.NextResponse.json({error:"Stage definition not found"},{status:404});let t=await p.executionLog.findFirst({where:{executionId:s,stageId:n},orderBy:{attemptNumber:"desc"}}),o=t?.attemptNumber??0,a=e.retryLimit??0;if(o>=a)return i.NextResponse.json({error:`Retry limit (${a}) reached for stage ${n}`},{status:400});await p.execution.update({where:{id:s},data:{status:"RUNNING",currentStageOrder:e.stageOrder}});let u=await p.executionLog.create({data:{executionId:s,stageId:n,userId:r,stageOrder:e.stageOrder,attemptNumber:o+1,inputs:t?.inputs??d.Prisma.JsonNull,validationResult:"pending",executedAt:new Date,rawOutput:null,parsedOutput:d.Prisma.JsonNull,validatorNotes:null,errorMessage:null,durationMs:null}});return console.log(`Retry attempt ${u.attemptNumber} initiated for stage ${n}. New log ID: ${u.id}`),i.NextResponse.json({message:"Stage retry initiated successfully.",logEntry:u},{status:200})}catch(e){if(console.error(`Error retrying stage ${n} for execution ${s}:`,e),e instanceof d.Prisma.PrismaClientKnownRequestError)return i.NextResponse.json({error:`Prisma error: ${e.code}`},{status:409});return i.NextResponse.json({error:"Failed to retry stage"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/executions/[executionId]/stages/[stageId]/retry/route",pathname:"/api/executions/[executionId]/stages/[stageId]/retry",filename:"route",bundlePath:"app/api/executions/[executionId]/stages/[stageId]/retry/route"},resolvedPagePath:"C:\\Users\\Mahdi\\Workspace\\ORCA\\src\\app\\api\\executions\\[executionId]\\stages\\[stageId]\\retry\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:g,serverHooks:m}=l;function f(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:g})}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6330:e=>{"use strict";e.exports=require("@prisma/client")},6487:()=>{},6760:e=>{"use strict";e.exports=require("node:path")},7598:e=>{"use strict";e.exports=require("node:crypto")},8335:()=>{},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,945],()=>r(4478));module.exports=s})();